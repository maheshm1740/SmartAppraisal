@model IEnumerable<DLSmartAppraisal.Model.UserDetails>

@{
    Layout = "/Views/Shared/_Layout.cshtml";

    var roleMap = new Dictionary<int, string>
    {
        {1, "Admin"},
        {2, "SME"},
        {3, "Candidate"},
        {4, "PM"},
        {5, "HR"}
    };

    var designationMap = new Dictionary<int, string>
    {
        {1, "Senior Software Developer"},
        {2, "Assistant Manager"},
        {3, "CEO"},
        {4, "Project Manager"},
        {5, "Tech Lead"}
    };
}

@section Styles {
    <link href="~/css/employee-list.css" rel="stylesheet" />
}

<div class="container-main">
    <h2>Employee List</h2>

    <div class="filters">
        <input type="text" id="searchInput" class="searchInput" placeholder="🔍 Search by UserId, Name, or EmpId" />

        <select id="roleFilter">
            <option value="">Filter by Role</option>
            @foreach (var role in roleMap)
            {
                <option value="@role.Key">@role.Value</option>
            }
        </select>

        <select id="designationFilter">
            <option value="">Filter by Designation</option>
            @foreach (var desig in designationMap)
            {
                <option value="@desig.Key">@desig.Value</option>
            }
        </select>

        <select id="createdByFilter">
            <option value="">Filter by Created By</option>
            @foreach (var created in Model.Select(m => m.CreatedBy).Distinct())
            {
                if (!string.IsNullOrEmpty(created))
                {
                    <option value="@created">@created</option>
                }
            }
        </select>

        <button type="button" id="resetFilters">Reset</button>
    </div>

    <div class="table-container">
        <table id="employeeTable">
            <thead>
                <tr>
                    <th>User ID</th>
                    <th>Name</th>
                    <th>Emp ID</th>
                    <th>Email</th>
                    <th>Designation</th>
                    <th>Role</th>
                    <th>Created By</th>
                    <th>Created Date</th>
                    <th>Is Active</th>
                    <th>Password Changed</th>
                    @* <th>Actions</th> *@
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr data-role="@item.RoleId" data-designation="@item.DesignationId">
                        <td>@item.UserId</td>
                        <td>@item.Name</td>
                        <td>@item.EmpId</td>
                        <td>@item.Email</td>
                        <td>@(designationMap.ContainsKey(item.DesignationId) ? designationMap[item.DesignationId] : "N/A")</td>
                        <td>@(roleMap.ContainsKey(item.RoleId) ? roleMap[item.RoleId] : "N/A")</td>
                        <td>@item.CreatedBy</td>
                        <td>@(item.CreatedDate?.ToString("dd-MMM-yyyy") ?? "-")</td>
                        <td>
                            @if (item.IsActive)
                            {
                                <span class="badge-active">Active</span>
                            }
                            else
                            {
                                <span class="badge-inactive">Inactive</span>
                            }
                        </td>
                        <td>@(item.PasswordChangeDate?.ToString("dd-MMM-yyyy") ?? "-")</td>
                        @* <td>
                            <button class="action-btn btn-view" title="View"><i class="bi bi-eye"></i></button>
                            <button class="action-btn btn-edit" title="Edit"><i class="bi bi-pencil"></i></button>
                            <button class="action-btn btn-delete" title="Delete"><i class="bi bi-trash"></i></button>
                        </td> *@
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script>
        $(function () {
            function filterTable() {
                var searchVal = $('#searchInput').val().toLowerCase();
                var roleVal = $('#roleFilter').val();
                var desigVal = $('#designationFilter').val();
                var createdByVal = $('#createdByFilter').val().toLowerCase();

                $('#employeeTable tbody tr').each(function () {
                    var row = $(this);
                    var matchesSearch = row.text().toLowerCase().indexOf(searchVal) > -1;
                    var matchesRole = !roleVal || row.data('role') == roleVal;
                    var matchesDesig = !desigVal || row.data('designation') == desigVal;
                    var matchesCreatedBy = !createdByVal || row.find('td:nth-child(7)').text().toLowerCase() === createdByVal;

                    if (matchesSearch && matchesRole && matchesDesig && matchesCreatedBy) {
                        row.fadeIn(150);
                    } else {
                        row.fadeOut(150);
                    }
                });
            }

            $('#searchInput, #roleFilter, #designationFilter, #createdByFilter').on('input change', filterTable);

            $('#resetFilters').on('click', function () {
                $('#searchInput').val('');
                $('#roleFilter').val('');
                $('#designationFilter').val('');
                $('#createdByFilter').val('');
                $('#employeeTable tbody tr').fadeIn(150);
            });
        });
    </script>
}
