@{
    ViewData["Title"] = "Change Password";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/css/changePassword.css" rel="stylesheet" />
</head>
<body>
    <div class="card p-4 mx-auto mt-5" style="max-width: 500px;">
        <h3 class="text-center mb-4">Change Password</h3>

        @if (!string.IsNullOrEmpty(ViewBag.ErrorMessage))
        {
            <div class="alert alert-danger text-center">@ViewBag.ErrorMessage</div>
        }

        @if (ViewBag.SuccessMessage != null)
        {
            <div class="alert alert-success text-center d-flex align-items-center justify-content-center gap-2">
                <span>@ViewBag.SuccessMessage</span>
                <div class="spinner-border spinner-border-sm text-success" role="status"></div>
            </div>

            <script>
                setTimeout(function () {
                    window.location.href = '@Url.Action("Index", "Login")';
                }, 2500); // Redirect after 2.5 seconds
            </script>
        }

        <form asp-action="ChangePassword" method="post" id="changePasswordForm">
            <div class="mb-3">
                <label for="userId" class="form-label">User ID</label>
                <input type="text" class="form-control" id="userId" name="UserId" value="@(ViewBag.UserId ?? "")" readonly />
            </div>

            <div class="mb-3">
                <label for="oldPassword" class="form-label">Old Password</label>
                <input type="password" class="form-control" id="oldPassword" name="OldPassword" />
                <div id="oldPassword-error" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label for="newPassword" class="form-label">New Password</label>
                <input type="password" class="form-control" id="newPassword" name="NewPassword" />
                <div id="newPassword-error" class="text-danger"></div>
            </div>

            <div class="mb-3">
                <label for="confirmPassword" class="form-label">Confirm Password</label>
                <input type="password" class="form-control" id="confirmPassword" name="ConfirmPassword" />
                <div id="confirmPassword-error" class="text-danger"></div>
            </div>

            <button type="submit" class="btn btn-gradient w-100">Change Password</button>

            <div class="text-center mt-3">
                <a href="@Url.Action("Index", "Home")" class="text-link">Back to Home</a>
            </div>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/jquery.validate.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.5/dist/additional-methods.min.js"></script>

    <script>
        $(document).ready(function () {
            $("#changePasswordForm").validate({
                rules: {
                    OldPassword: { required: true },
                    NewPassword: {
                        required: true,
                        minlength: 6,
                        notEqualToOld: true
                    },
                    ConfirmPassword: { required: true, equalTo: "#newPassword" }
                },
                messages: {
                    OldPassword: { required: "Enter your old password" },
                    NewPassword: {
                        required: "Enter a new password",
                        minlength: "Password must be at least 6 characters",
                        notEqualToOld: "New password cannot be the same as old password"
                    },
                    ConfirmPassword: { required: "Confirm your new password", equalTo: "Passwords do not match" }
                },
                errorPlacement: function (error, element) {
                    const id = element.attr("id");
                    error.appendTo($("#" + id + "-error"));
                },
                highlight: function (element) {
                    $(element).addClass("is-invalid");
                },
                unhighlight: function (element) {
                    $(element).removeClass("is-invalid");
                }
            });
      
            $.validator.addMethod("notEqualToOld", function (value, element) {
                return value !== $("#oldPassword").val();
            }, "New password cannot be the same as old password");
        });
    </script>
</body>
</html>
